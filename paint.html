<!DOCTYPE html>

<html>
  <head>
    <title>HTML5 Paint</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <style>
      *, *:before, *:after {
        box-sizing: border-box;
      }
      .toolbar {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 5px;
        width: 900px;
      }
      #drawingboard {
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <div class="toolbar">
      <button title="Pencil" id="pencil_tool"><i class="fa fa-pencil"></i></button>
      <button title="Line" id="line_tool"><i class="fa fa-minus"></i></button>
      <button title="Circle" id="circle_tool"><i class="fa fa-circle-o"></i></button>
      <button title="Filled Circle" id="fcircle_tool"><i class="fa fa-circle"></i></button>
    </div>
    <canvas id="drawingboard" width="900" height="600"></canvas>
    <script src="paint.js"></script>
    <script>
      var paint, pencil;

      function startDrawing(event) {
        paint.basePoint = new Point(event.clientX - paint.canvas.offsetLeft,
                event.clientY - paint.canvas.offsetTop);
        paint.previousPoint = paint.basePoint;
        paint.isDrawing = true;
        if (paint.currentTool == paint.PENCIL) {
          pencil = new Pencil(paint.context);
        }
      }

      function stopDrawing(event) {
        paint.isDrawing = false;
        var pt = new Point(event.clientX - paint.canvas.offsetLeft,
                event.clientY - paint.canvas.offsetTop);
        if (paint.currentTool == paint.LINE) {
          var l = new Line(paint.context, paint.basePoint, pt);
          paint.content.push(l);
          paint.repaint();
          paint.basePoint = null;
        } else if (paint.currentTool == paint.PENCIL) {
          var l = new Line(paint.context, paint.previousPoint, pt);
          pencil.addLine(l);
          paint.content.push(pencil);
          paint.repaint();
          paint.basePoint = null;
          paint.previousPoint = null;
          pencil = null;
        } else if (paint.currentTool == paint.CIRCLE) {
          var centerX = paint.basePoint.x + (pt.x - paint.basePoint.x) / 2;
          var centerY = paint.basePoint.y + (pt.y - paint.basePoint.y) / 2;
          var center = new Point(centerX, centerY);
          var c = new Circle(paint.context, center, (pt.x - paint.basePoint.x) / 2);
          paint.content.push(c);
          paint.repaint();
          paint.basePoint = null;
        }
      }

      function drawing(event) {
        var pt = new Point(event.clientX - paint.canvas.offsetLeft,
                event.clientY - paint.canvas.offsetTop);
        if (paint.isDrawing) {
          if (paint.currentTool == paint.LINE) {
            paint.repaint();
            var l = new Line(paint.context, paint.basePoint, pt);
            l.stroke();
//            paint.basePoint = pt;
          } else if (paint.currentTool == paint.PENCIL) {
            var l = new Line(paint.context, paint.previousPoint, pt);
            pencil.addLine(l);
            l.stroke();
            paint.previousPoint = pt;
          } else if (paint.currentTool == paint.CIRCLE) {
            paint.repaint();
            var centerX, centerY;
            if (pt.x > paint.basePoint.x) {
              centerX = paint.basePoint.x + (pt.x - paint.basePoint.x) / 2;
            } else {
              centerX = paint.basePoint.x - (paint.basePoint.x - pt.x) / 2;
            }
            if (pt.y > paint.basePoint.y) {
              centerY = paint.basePoint.y + (pt.y - paint.basePoint.y) / 2;
            } else {
              centerY = paint.basePoint.y - (paint.basePoint.y - pt.y) / 2;
            }
//            var centerY = paint.basePoint.y + (Math.abs(pt.y - paint.basePoint.y) / 2);
            var center = new Point(centerX, centerY);
            var c = new Circle(paint.context, center, Math.abs(pt.x - paint.basePoint.x) / 2);
            c.stroke();
          }
        }
      }

      window.onload = function () {
        paint = new Paint();
        paint.setCurrentTool(paint.LINE);
        paint.canvas.addEventListener('mousedown', startDrawing, false);
        paint.canvas.addEventListener('mouseup', stopDrawing, false);
        paint.canvas.addEventListener('mousemove', drawing, false);

        document.getElementById("line_tool").addEventListener('click', function () {
          paint.setCurrentTool(paint.LINE);
        });
        document.getElementById("pencil_tool").addEventListener('click', function () {
          paint.setCurrentTool(paint.PENCIL);
        });
        document.getElementById("circle_tool").addEventListener('click', function () {
          paint.setCurrentTool(paint.CIRCLE);
        });
        document.getElementById("fcircle_tool").addEventListener('click', function () {
          paint.setCurrentTool(paint.FILLED_CIRCLE);
        });
      };
    </script>
  </body>
</html>
